<!DOCTYPE html>
<html lang="en">
<link>
<meta charset="utf-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
<title>UDP Broadcast Testclient</title>

<!-- Bootstrap -->
<link href="css/bootstrap.min.css" rel="stylesheet"/>
<link href="css/udp.css" rel="stylesheet"/>
</head>
<body>
<nav class="navbar navbar-default navbar-fixed-top navbar-inverse">
    <div class="container">
        <div class="navbar-brand">UDP Monitor</div>
        <ul class="nav navbar-nav">
            <li class="active"><a href="#receive">Enpfangen</a></li>
            <li><a href="#send">Senden</a></li>
        </ul>
    </div>
</nav>
<div class="container">
    <div class="row">
        <div class="col-sm-12">
            <form class="form-inline">
                <div class="input-group">
                    <span class="input-group-addon">Port</span>
                    <input type="text" id="port" name="port" class="form-control" value="10000">
                </div>
                <button type="button" class="btn btn-default" data-action="start">Start</button>
                <button type="button" class="btn btn-default" data-action="stop">Stop</button>
            </form>
        </div>
    </div>
    <div class="row">
        <div class="col-sm-12">
            <pre id="received" class="margin-bt"></pre>
        </div>
    </div>

</div>

<script src="js/jquery-2.1.4.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/sockjs.min.js"></script>
<script src="js/stomp.min.js"></script>
<script type="text/javascript">
    var stompClient = null;

    function connect() {
        var socket = new SockJS('/udp');
        stompClient = Stomp.over(socket);
        stompClient.heartbeat.outgoing = 2000;
        stompClient.heartbeat.incoming = 2000;
        stompClient.connect({}, function (frame) {
            stompClient.subscribe('/topic/receive', function (message) {
                if (message.body) {
                    var datagram = JSON.parse(message.body);
                    var log = datagram.hex + "\n";
                    $('#received').append(log);
                    window.scrollTo(0, document.body.scrollHeight);
                }
            });
        });
    }

    function disconnect() {
        if (stompClient != null) {
            stompClient.disconnect();
        }
    }

    $(document).ready(function () {
        connect();
        $('[data-action="start"]').on("click", function () {
            stompClient.send("/udp/start", {}, $('[name="port"]').val());
        });
        $('[data-action="stop"]').on("click", function () {
            stompClient.send("/udp/stop", {});
        })
    });

</script>
</body>
</html>